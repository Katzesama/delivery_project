{% extends 'base.html' %}

{% block title %}菜单{% endblock %}

{% load static %}

{% block content %}
const csrf_token = "{{ csrf_token }}";
<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-gray-800">菜单</h1>
  <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
</div>

  <div id="holder" class="row"></div>
  <script type="text/javascript">
  request_sender = {}

  function show_dish(data) {
    var holder = document.getElementById("holder");
    // loop through and create a section for each dish sent by at the current page
    for (var i = 0; i < data.posts.length; i++) {
      // most outter container of the dish section
      let dish = document.createElement("div");
      dish.class = "card shadow mb-4";
      holder.appendChild(dish);

      // add header to the dish section
      let header_ct = document.createElement("div");
      header_ct.class = "card-header py-3";
      dish.appendChild(header_ct);
      let header = document.createElement("h6");
      header.class = "m-0 font-weight-bold shadow text-primary";
      header.contenteditable = "true";
      header_ct.appendChild(header);

      // add the body part to the dish section
      let body = document.createElement("div");
      body.class = "card-body row no-gutters align-items-center";
      dish.appendChild(body);

      data.posts[i]['author']['id'];
      console.info(data.posts[i].author.displayName);
      author.innerHTML = 'Author: ' + data.posts[i].author.displayName;
      author.href = '/author/' + author_id +'/';
      author.style.fontSize='25px';
      author.style.display = "inline-block";
      post.appendChild(author);
      var line = document.createElement("br");
      post.appendChild(line);
      var post_link = document.createElement("a");
      let postid = data.posts[i].id
      post_link.innerHTML = "Post title: " + data.posts[i].title;
      post_link.href = '/posts/' + postid + '/';
      post.appendChild(post_link);
      var line = document.createElement("br");
      post.appendChild(line);
      var description = document.createElement("p");
      description.innerHTML = "description: " + data.posts[i].description
      post.appendChild(description);

      var edit_button = document.createElement("button");
      edit_button.innerHTML = 'Edit';
      var del_button = document.createElement("button");
      del_button.innerHTML = 'Delete';
      del_button.style.color = "#DD678C";
      var com_button = document.createElement("button");
      com_button.innerHTML = 'Comments';
      edit_button.onclick=function(){
        location.href = '/posts/' + postid + '/edit_post/';
      };
      del_button.onclick=function(){
        location.href = '/posts/' + postid + '/del_post/';
      };
      com_button.onclick=function(){
        location.href = '/posts/' + postid + '/comments/view/';
      }
      post.appendChild(edit_button);
      post.appendChild(com_button);
      post.appendChild(del_button);


      var line = document.createElement("hr");
      post.appendChild(line);
    }

    if (data.next != null)
    {
      var nextButton = document.createElement("button");
      nextButton.innerHTML = 'next page';
      nextButton.onclick=function(){
        get_data_display(data.next);
      };
      holder.appendChild(nextButton);
    }
    if (data.previous != null)
    {
      var preButton = document.createElement("button");
      preButton.innerHTML = 'previous page';
      preButton.onclick=function(){
        get_data_display(data.previous);
      };
      holder.appendChild(preButton);
      }
}

  // https://uofa-cmput404.github.io/cmput404-slides/08-AJAX.html#/9
  // https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch
  function fetchJSON(url) {
    var request = new Request(url, {
                method: 'GET',
                headers: {
                     'Content-Type': 'application/json'
                },
                });
    return fetch(request).then((response) => {
      if (response.status === 200) { // OK
        return response.json(); // return a Promise
      } else {
        alert("Something went wrong: " + response.status);
      }
    });
  }


  function get_data_display(url) {
      fetchJSON(url).then(show_dish);
  }

  get_data_display("{{fetch_url}}");


</script>


{% endblock %}
